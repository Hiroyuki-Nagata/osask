init:
  - git config --global core.autocrlf input

platform:
  - x86
  - x64

environment:
  matrix:
    - tbs_arch: "x86"
      tbs_tools: "mingw"
      tbs_static_runtime: 1
    
    - tbs_arch: "x64"
      tbs_tools: "mingw"
      tbs_static_runtime: 1

install:
  # Since the AppVeyor VMs have Git installed, they have MSYS1
  - sh --login /c/projects/pipe/scripts/appveyor
  - ps: if($env:tbs_arch -eq 'x64') {
          $env:vcvar_arg = 'x86_amd64';
        }
        elseif($env:tbs_arch -eq 'x86') {
          $env:vcvar_arg = 'x86';
        }  
  - cinst mingw-get
  - set PATH=%PATH%;C:\MinGW\msys\1.0\bin;C:\MinGW\bin
  - mingw-get install mingw-developer-toolkit

# to disable automatic builds ( disable MSbuild )
build: off

# Use MinGW make
build_script:
  - if [%tbs_tools%]==[mingw] if [%tbs_arch%]==[x86] SET PATH=C:\MinGW\bin;%PATH%
  - if [%tbs_tools%]==[mingw] if [%tbs_arch%]==[x64] SET PATH=C:\mingw64\bin;%PATH%
  - bash ./bootstrap && bash ./configure && make